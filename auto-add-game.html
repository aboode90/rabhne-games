<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¶Ø§ÙØ© Ù„Ø¹Ø¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© - Rabhne</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        input, select, button { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { background: #007bff; color: white; border: none; cursor: pointer; font-size: 16px; }
        button:hover { background: #0056b3; }
        .message { padding: 15px; margin: 20px 0; border-radius: 5px; display: none; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® Ø¥Ø¶Ø§ÙØ© Ù„Ø¹Ø¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</h1>
        <p>Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ù† GameDistribution ÙˆØ³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
        
        <div id="message" class="message"></div>
        
        <input type="url" id="gameUrl" placeholder="https://gamedistribution.com/games/game-name/" required>
        <input type="text" id="gameTitle" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <select id="gameCategory">
            <option value="puzzle">Ø£Ù„ØºØ§Ø²</option>
            <option value="action">Ø£ÙƒØ´Ù†</option>
            <option value="racing">Ø³Ø¨Ø§Ù‚</option>
            <option value="sports">Ø±ÙŠØ§Ø¶Ø©</option>
            <option value="adventure">Ù…ØºØ§Ù…Ø±Ø©</option>
        </select>
        
        <button onclick="autoAddGame()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø¹Ø¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</button>
        <button onclick="loginWithGoogle()" id="loginBtn">ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>

    <script>
        let currentUser = null;

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function loginWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                const result = await auth.signInWithPopup(provider);
                currentUser = result.user;
                showMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                document.getElementById('loginBtn').style.display = 'none';
            } catch (error) {
                showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message, 'error');
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø¹Ø¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        async function autoAddGame() {
            if (!currentUser) {
                showMessage('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }

            const gameUrl = document.getElementById('gameUrl').value;
            const customTitle = document.getElementById('gameTitle').value;
            const category = document.getElementById('gameCategory').value;

            if (!gameUrl) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù„Ø¹Ø¨Ø©', 'error');
                return;
            }

            try {
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
                const gameInfo = extractGameInfo(gameUrl);
                
                if (!gameInfo) {
                    showMessage('Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ù† GameDistribution', 'error');
                    return;
                }

                // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
                const gameData = {
                    title: customTitle || gameInfo.title,
                    slug: gameInfo.slug,
                    iframeUrl: gameInfo.iframeUrl,
                    thumbnail: gameInfo.thumbnail,
                    category: category,
                    active: true,
                    plays: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù„Ø¹Ø¨Ø©
                const existingGame = await db.collection('games')
                    .where('slug', '==', gameData.slug)
                    .get();

                if (!existingGame.empty) {
                    showMessage('Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„!', 'error');
                    return;
                }

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
                const docRef = await db.collection('games').add(gameData);
                showMessage(`âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­!\nğŸ†” Ø§Ù„Ù…Ø¹Ø±Ù: ${docRef.id}\nğŸ® Ø§Ù„Ø§Ø³Ù…: ${gameData.title}`, 'success');
                
                // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                document.getElementById('gameUrl').value = '';
                document.getElementById('gameTitle').value = '';

            } catch (error) {
                showMessage('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø¹Ø¨Ø©: ' + error.message, 'error');
            }
        }

        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
        function extractGameInfo(url) {
            try {
                // Ù…Ø«Ø§Ù„: https://gamedistribution.com/games/foxy-eco-sort/
                const match = url.match(/gamedistribution\.com\/games\/([^\/]+)/);
                if (!match) return null;

                const gameName = match[1];
                const slug = gameName;
                
                // Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ©
                const knownGames = {
                    'foxy-eco-sort': {
                        title: 'Foxy Eco Sort',
                        iframeUrl: 'https://html5.gamedistribution.com/rvvASWA4/8e3527971f5c4457b0691897f02111bb/index.html',
                        thumbnail: 'https://img.gamedistribution.com/8e3527971f5c4457b0691897f02111bb-512x384.jpeg'
                    }
                };

                if (knownGames[gameName]) {
                    return {
                        slug: slug,
                        title: knownGames[gameName].title,
                        iframeUrl: knownGames[gameName].iframeUrl,
                        thumbnail: knownGames[gameName].thumbnail
                    };
                }

                // Ù„Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© - ØªØ®Ù…ÙŠÙ† Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
                return {
                    slug: slug,
                    title: gameName.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                    iframeUrl: `https://html5.gamedistribution.com/rvvASWA4/${gameName}/index.html`,
                    thumbnail: `https://img.gamedistribution.com/${gameName}-512x384.jpeg`
                };

            } catch (error) {
                console.error('Error extracting game info:', error);
                return null;
            }
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = 'message ' + type;
            messageEl.style.display = 'block';
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 8000);
        }

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            if (user) {
                document.getElementById('loginBtn').style.display = 'none';
            }
        });
    </script>
</body>
</html>